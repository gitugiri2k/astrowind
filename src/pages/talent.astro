---
import Layout from '~/layouts/PageLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';

const metadata = {
  title: 'Join Our Talent Community | AA Cognitech',
  description:
    'Submit your information to join our talent network and be considered for future opportunities that match your skills and career goals.',
};
---

<Layout metadata={metadata}>
  <!-- Hero Widget ******************* -->
  <Hero
    tagline="Talent Community"
    title="Join Our Talent Network"
    subtitle="Submit your information to stay connected with AA Cognitech and be considered for future opportunities that match your skills and career goals."
    image={{
      src: 'https://images.unsplash.com/photo-1557804506-669a67965ba0?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1740&q=80',
      alt: 'AA Cognitech Talent Community',
    }}
  />

  <!-- Talent Community Form Section -->
  <section class="py-16 bg-gray-50 dark:bg-slate-800">
    <div class="max-w-3xl mx-auto px-4 sm:px-6">
      <div
        class="border border-gray-200 dark:border-slate-600 rounded-xl p-6 md:p-8 bg-white dark:bg-slate-900 shadow-lg"
      >
        <h2 class="text-3xl font-bold mb-8 text-center">Submit Your Information</h2>

        <!-- Form submission messages -->
        <div id="form-success" class="hidden bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded mb-6">
          Thank you for submitting your information! We've added you to our talent community and will contact you about
          relevant opportunities.
        </div>

        <div id="form-error" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-6">
          There was an error submitting your information. Please try again or contact us directly at
          careers@aacognitech.com
        </div>

        <form
          id="talent-community-form"
          class="space-y-6"
          method="POST"
          action="https://getform.io/f/allydwda"
          enctype="multipart/form-data"
        >
          <!-- Personal Information -->
          <div class="space-y-4">
            <h3 class="text-xl font-semibold">Personal Information</h3>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="firstName" class="block text-sm font-medium mb-1"
                  >First Name <span class="text-red-600">*</span></label
                >
                <input
                  type="text"
                  id="firstName"
                  name="firstName"
                  required
                  aria-required="true"
                  class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-800"
                  autocomplete="given-name"
                />
                <div class="text-red-600 text-xs mt-1 hidden error-message" id="firstName-error"></div>
              </div>

              <div>
                <label for="lastName" class="block text-sm font-medium mb-1"
                  >Last Name <span class="text-red-600">*</span></label
                >
                <input
                  type="text"
                  id="lastName"
                  name="lastName"
                  required
                  aria-required="true"
                  class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-800"
                  autocomplete="family-name"
                />
                <div class="text-red-600 text-xs mt-1 hidden error-message" id="lastName-error"></div>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="email" class="block text-sm font-medium mb-1"
                  >Email <span class="text-red-600">*</span></label
                >
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  aria-required="true"
                  class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-800"
                  autocomplete="email"
                />
                <div class="text-red-600 text-xs mt-1 hidden error-message" id="email-error"></div>
              </div>

              <div>
                <label for="phone" class="block text-sm font-medium mb-1"
                  >Phone Number <span class="text-red-600">*</span></label
                >
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  required
                  aria-required="true"
                  class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-800"
                  autocomplete="tel"
                  placeholder="(123) 456-7890"
                />
                <div class="text-red-600 text-xs mt-1 hidden error-message" id="phone-error"></div>
              </div>
            </div>

            <div>
              <label for="location" class="block text-sm font-medium mb-1"
                >Current Location <span class="text-red-600">*</span></label
              >
              <input
                type="text"
                id="location"
                name="location"
                required
                aria-required="true"
                placeholder="City, State/Province, Country"
                class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-800"
                autocomplete="address-level2"
              />
              <div class="text-red-600 text-xs mt-1 hidden error-message" id="location-error"></div>
            </div>
          </div>

          <!-- Professional Information -->
          <div class="space-y-4 pt-4 border-t border-gray-200 dark:border-slate-700">
            <h3 class="text-xl font-semibold">Professional Information</h3>

            <div>
              <label for="resume" class="block text-sm font-medium mb-1"
                >Upload Resume <span class="text-red-600">*</span></label
              >
              <div class="relative">
                <input
                  type="file"
                  id="resume"
                  name="resume"
                  accept=".pdf,.doc,.docx"
                  required
                  aria-required="true"
                  class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-800"
                />
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                  <span id="file-selected" class="text-sm text-gray-500 truncate max-w-[150px]"></span>
                </div>
              </div>
              <p class="text-xs text-gray-500 mt-1">Accepted formats: PDF, DOC, DOCX (Max 5MB)</p>
              <div class="text-red-600 text-xs mt-1 hidden error-message" id="resume-error"></div>
            </div>

            <div>
              <label for="linkedin" class="block text-sm font-medium mb-1">LinkedIn Profile URL</label>
              <input
                type="url"
                id="linkedin"
                name="linkedin"
                placeholder="https://www.linkedin.com/in/yourprofile"
                class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-800"
              />
              <div class="text-red-600 text-xs mt-1 hidden error-message" id="linkedin-error"></div>
            </div>

            <div>
              <label for="experience" class="block text-sm font-medium mb-1"
                >Years of Experience <span class="text-red-600">*</span></label
              >
              <select
                id="experience"
                name="experience"
                required
                aria-required="true"
                class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-800"
              >
                <option value="">Select</option>
                <option value="0-2">0-2 years</option>
                <option value="3-5">3-5 years</option>
                <option value="6-10">6-10 years</option>
                <option value="11-15">11-15 years</option>
                <option value="16+">16+ years</option>
              </select>
              <div class="text-red-600 text-xs mt-1 hidden error-message" id="experience-error"></div>
            </div>

            <div>
              <label for="jobType" class="block text-sm font-medium mb-1"
                >Preferred Job Type <span class="text-red-600">*</span></label
              >
              <select
                id="jobType"
                name="jobType"
                required
                aria-required="true"
                class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-800"
              >
                <option value="">Select</option>
                <option value="Full-time">Full-time</option>
                <option value="Contract">Contract</option>
                <option value="Either">Either</option>
              </select>
              <div class="text-red-600 text-xs mt-1 hidden error-message" id="jobType-error"></div>
            </div>

            <div>
              <label for="workArrangement" class="block text-sm font-medium mb-1"
                >Preferred Work Arrangement <span class="text-red-600">*</span></label
              >
              <select
                id="workArrangement"
                name="workArrangement"
                required
                aria-required="true"
                class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-800"
              >
                <option value="">Select</option>
                <option value="Remote">Remote</option>
                <option value="Hybrid">Hybrid</option>
                <option value="On-site">On-site</option>
                <option value="Flexible">Flexible</option>
              </select>
              <div class="text-red-600 text-xs mt-1 hidden error-message" id="workArrangement-error"></div>
            </div>

            <div>
              <label for="skills" class="block text-sm font-medium mb-1"
                >Key Skills <span class="text-red-600">*</span></label
              >
              <textarea
                id="skills"
                name="skills"
                rows="3"
                required
                aria-required="true"
                placeholder="List your key technical skills, separated by commas"
                class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-800"
              ></textarea>
              <div class="text-red-600 text-xs mt-1 hidden error-message" id="skills-error"></div>
            </div>
          </div>

          <!-- Interests -->
          <div class="space-y-4 pt-4 border-t border-gray-200 dark:border-slate-700">
            <h3 class="text-xl font-semibold">Career Interests</h3>

            <div>
              <fieldset>
                <legend class="block text-sm font-medium mb-1"
                  >Job Categories of Interest <span class="text-red-600">*</span></legend
                >
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="software-dev"
                      name="jobInterests[]"
                      value="Software Development"
                      class="h-4 w-4 text-primary-600"
                    />
                    <label for="software-dev" class="ml-2 text-sm">Software Development</label>
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="data-science"
                      name="jobInterests[]"
                      value="Data Science"
                      class="h-4 w-4 text-primary-600"
                    />
                    <label for="data-science" class="ml-2 text-sm">Data Science & AI</label>
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="cloud"
                      name="jobInterests[]"
                      value="Cloud Computing"
                      class="h-4 w-4 text-primary-600"
                    />
                    <label for="cloud" class="ml-2 text-sm">Cloud Computing</label>
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="cybersecurity"
                      name="jobInterests[]"
                      value="Cybersecurity"
                      class="h-4 w-4 text-primary-600"
                    />
                    <label for="cybersecurity" class="ml-2 text-sm">Cybersecurity</label>
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="devops"
                      name="jobInterests[]"
                      value="DevOps"
                      class="h-4 w-4 text-primary-600"
                    />
                    <label for="devops" class="ml-2 text-sm">DevOps & IT Operations</label>
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="erp-crm"
                      name="jobInterests[]"
                      value="ERP & CRM"
                      class="h-4 w-4 text-primary-600"
                    />
                    <label for="erp-crm" class="ml-2 text-sm">ERP & CRM</label>
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="it-recruitment"
                      name="jobInterests[]"
                      value="IT Recruitment"
                      class="h-4 w-4 text-primary-600"
                    />
                    <label for="it-recruitment" class="ml-2 text-sm">IT Recruitment</label>
                  </div>
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="consulting"
                      name="jobInterests[]"
                      value="IT Consulting"
                      class="h-4 w-4 text-primary-600"
                    />
                    <label for="consulting" class="ml-2 text-sm">IT Consulting</label>
                  </div>
                </div>
                <div class="text-red-600 text-xs mt-1 hidden error-message" id="jobInterests-error">
                  Please select at least one job category
                </div>
              </fieldset>
            </div>

            <div>
              <label for="additionalInfo" class="block text-sm font-medium mb-1">Additional Information</label>
              <textarea
                id="additionalInfo"
                name="additionalInfo"
                rows="3"
                placeholder="Tell us more about your career interests and goals"
                class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-800"
              ></textarea>
            </div>

            <div class="flex items-start">
              <div class="flex items-center h-5">
                <input
                  id="communication"
                  name="communication"
                  type="checkbox"
                  required
                  aria-required="true"
                  class="h-4 w-4 text-primary-600"
                />
              </div>
              <div class="ml-3 text-sm">
                <label for="communication" class="font-medium"
                  >Communication Consent <span class="text-red-600">*</span></label
                >
                <p class="text-gray-500 dark:text-gray-400">
                  I agree to receive communications from AA Cognitech about job opportunities and career resources. I
                  understand I can unsubscribe at any time.
                </p>
                <div class="text-red-600 text-xs mt-1 hidden error-message" id="communication-error"></div>
              </div>
            </div>

            <div class="flex items-start">
              <div class="flex items-center h-5">
                <input
                  id="privacy-policy"
                  name="privacyPolicy"
                  type="checkbox"
                  required
                  aria-required="true"
                  class="h-4 w-4 text-primary-600"
                />
              </div>
              <div class="ml-3 text-sm">
                <label for="privacy-policy" class="font-medium"
                  >Privacy Policy <span class="text-red-600">*</span></label
                >
                <p class="text-gray-500 dark:text-gray-400">
                  I have read and agree to AA Cognitech's <a
                    href="/privacy-policy"
                    class="text-primary-600 hover:underline">Privacy Policy</a
                  > regarding the collection and use of my personal information.
                </p>
                <div class="text-red-600 text-xs mt-1 hidden error-message" id="privacy-policy-error"></div>
              </div>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="pt-4">
            <button type="submit" id="submit-button" class="w-full btn btn-primary flex justify-center items-center">
              <span>Submit Application</span>
              <span id="loading-spinner" class="ml-2 hidden">
                <svg
                  class="animate-spin h-5 w-5 text-white"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path
                    class="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                  ></path>
                </svg>
              </span>
            </button>
          </div>

          <!-- Hidden honeypot field to prevent spam -->
          <div class="hidden">
            <label for="website">Website</label>
            <input type="text" id="website" name="website" tabindex="-1" autocomplete="off" />
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- CallToAction Widget *********** -->
  <CallToAction
    actions={[
      {
        variant: 'primary',
        text: 'Browse Current Openings',
        href: '/job-openings',
      },
    ]}
    title="Looking for immediate opportunities?"
    subtitle="Check out our current job openings to find positions that match your skills and experience."
  />
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Safely get elements with null checks
    const form = document.getElementById('talent-community-form') as HTMLFormElement | null;
    const submitButton = document.getElementById('submit-button') as HTMLButtonElement | null;
    const loadingSpinner = document.getElementById('loading-spinner');
    const formSuccess = document.getElementById('form-success');
    const formError = document.getElementById('form-error');
    const fileInput = document.getElementById('resume') as HTMLInputElement | null;
    const fileSelected = document.getElementById('file-selected');

    // Only proceed if elements are found
    if (!form || !submitButton || !loadingSpinner || !formSuccess || !formError || !fileInput || !fileSelected) {
      console.error('One or more required form elements not found');
      return;
    }

    // File selection display
    fileInput.addEventListener('change', () => {
      if (fileInput.files && fileInput.files.length > 0) {
        fileSelected.textContent = fileInput.files[0].name;
      } else {
        fileSelected.textContent = '';
      }
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Reset error messages
      document.querySelectorAll('.error-message').forEach((el) => {
        el.classList.add('hidden');
      });

      let isValid = true;

      // Validate required fields
      const requiredFields = form.querySelectorAll('[required]');
      requiredFields.forEach((field) => {
        const inputField = field as HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement;
        const errorElement = document.getElementById(`${inputField.id}-error`);

        if (inputField instanceof HTMLInputElement && inputField.type === 'checkbox' && !inputField.checked) {
          if (errorElement) {
            errorElement.textContent = 'You must agree to continue';
            errorElement.classList.remove('hidden');
          }
          isValid = false;
        } else if (!(inputField instanceof HTMLInputElement && inputField.type === 'file') && !inputField.value) {
          if (errorElement) {
            errorElement.textContent = 'This field is required';
            errorElement.classList.remove('hidden');
          }
          isValid = false;
        }
      });

      // Validate email format
      const emailField = document.getElementById('email') as HTMLInputElement | null;
      if (emailField) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (emailField.value && !emailRegex.test(emailField.value)) {
          const emailError = document.getElementById('email-error');
          if (emailError) {
            emailError.textContent = 'Please enter a valid email address';
            emailError.classList.remove('hidden');
          }
          isValid = false;
        }
      }

      // Validate file size
      if (fileInput.files && fileInput.files.length > 0) {
        const fileSize = fileInput.files[0].size / 1024 / 1024; // Convert to MB
        if (fileSize > 5) {
          const resumeError = document.getElementById('resume-error');
          if (resumeError) {
            resumeError.textContent = 'File size must be less than 5MB';
            resumeError.classList.remove('hidden');
          }
          isValid = false;
        }
      }

      // Validate job interests
      const jobInterests = form.querySelectorAll('input[name="jobInterests[]"]:checked');
      if (jobInterests.length === 0) {
        const jobInterestsError = document.getElementById('jobInterests-error');
        if (jobInterestsError) {
          jobInterestsError.classList.remove('hidden');
        }
        isValid = false;
      }

      // Check honeypot field
      const honeypot = document.getElementById('website') as HTMLInputElement | null;
      if (honeypot && honeypot.value) return;

      if (!isValid) {
        const firstError = document.querySelector('.error-message:not(.hidden)');
        if (firstError) {
          firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        return;
      }

      // Submit form
      submitButton.disabled = true;
      loadingSpinner.classList.remove('hidden');

      try {
        const formData = new FormData(form);
        const response = await fetch(form.action, {
          method: 'POST',
          body: formData,
          headers: { Accept: 'application/json' },
        });

        if (response.ok) {
          form.reset();
          fileSelected.textContent = '';
          formSuccess.classList.remove('hidden');
          formError.classList.add('hidden');
          formSuccess.scrollIntoView({ behavior: 'smooth', block: 'center' });

          // Hide success message after 10 seconds
          setTimeout(() => {
            formSuccess.classList.add('hidden');
          }, 10000);
        } else {
          formError.classList.remove('hidden');
          formSuccess.classList.add('hidden');
          formError.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      } catch (error) {
        console.error('Form submission error:', error);
        formError.classList.remove('hidden');
        formSuccess.classList.add('hidden');
        formError.scrollIntoView({ behavior: 'smooth', block: 'center' });
      } finally {
        submitButton.disabled = false;
        loadingSpinner.classList.add('hidden');
      }
    });
  });
</script>
